<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Igor DejanoviÄ‡" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Parse tree - Arpeggio</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Parse tree";
        var mkdocs_page_input_path = "parse_trees.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-68681917-1"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', "UA-68681917-1");
      </script>
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Arpeggio
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../getting_started/">Getting started</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../grammars/">Grammars</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Parse tree</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#terminal-nodes">Terminal nodes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#non-terminal-nodes">Non-terminal nodes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#printing-parse-trees">Printing parse trees</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#parse-tree-reduction">Parse tree reduction</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#suppressing-parse-tree-nodes">Suppressing parse tree nodes</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../handling_errors/">Handling errors</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../debugging/">Debugging</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configuration/">Parser configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../semantics/">Semantic analysis</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutorials</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tutorials/csv/">CSV</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tutorials/bibtex/">BibTex</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tutorials/calc/">Calc</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../about/discuss/">Discuss</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../about/contributing/">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../about/license/">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Arpeggio</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">User Guide</li>
      <li class="breadcrumb-item active">Parse tree</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/textX/Arpeggio/edit/master/docs/parse_trees.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="parse-trees">Parse trees<a class="headerlink" href="#parse-trees" title="Permanent link">&para;</a></h1>
<p>Parse tree is a first structure you get from a successful parse.</p>
<hr />
<p>Parse tree or concrete syntax tree is a tree structure built from the input
string during parsing.  It represent the structure of the input string. Each
node in the parse tree is either a <a href="#terminal-nodes">terminal</a> or
<a href="#non-terminal-nodes">non-terminal</a>. Terminals are the leafs of the tree while
the inner nodes are non-terminals.</p>
<p>Here is an example parse tree for the <code>calc</code> grammar and the expression
<code>-(4-1)*5+(2+4.67)+5.89/(.2+7)</code>:</p>
<p><a href="../images/calc_parse_tree.dot.png" target="_blank"><img src="../images/calc_parse_tree.dot.png"/></a></p>
<p>Each non-leaf node is non-terminal. The name in this nodes are the names of the
grammar PEG rules that created them.</p>
<p>The leaf nodes are terminals and they are matched by the <em>string match</em> or <em>regex
match</em> rules.</p>
<p>In the square brackets is the location in the input stream where the
terminal/non-terminal is recognized.</p>
<p>Each parse tree node has the following attributes:</p>
<ul>
<li><strong>rule</strong> - the parsing expression that created this node.</li>
<li><strong>rule_name</strong> - the name of the rule if it was the root rule or empty string
  otherwise.</li>
<li><strong>position</strong> - the position in the input stream where this node was
  recognized.</li>
<li><strong>position_end</strong> - the end of the node in the input stream. This index is one
  char behind the last char that belongs to this node. Thus, <code>position_end -
  position == length of the node</code>.</li>
</ul>
<p>If you want to get line and column from position you can use <code>pos_to_linecol</code>
parser method.</p>
<pre><code class="language-python">  line, col = parser.pos_to_linecol(node.position)
</code></pre>
<h2 id="terminal-nodes">Terminal nodes<a class="headerlink" href="#terminal-nodes" title="Permanent link">&para;</a></h2>
<p>Terminals in Arpeggio are created by the specializations of the parsing
expression <code>Match</code> class.  There are two specialization of <code>Match</code> class:</p>
<ul>
<li><code>StrMatch</code> if the literal string is matched from the input or</li>
<li><code>RegExMatch</code> if a regular expression is used to match input.</li>
</ul>
<p>To get the matched string from the terminal object just convert it to string
(e.g. <code>str(t)</code> where <code>t</code> is of <code>Terminal</code> type).</p>
<h2 id="non-terminal-nodes">Non-terminal nodes<a class="headerlink" href="#non-terminal-nodes" title="Permanent link">&para;</a></h2>
<p>Non-terminal nodes are non-leaf nodes of the parse tree. They are created by PEG
grammar rules.  Children of non-terminals can be other non-terminals or
terminals.</p>
<p>For example, nodes with the labels <code>expression</code>, <code>factor</code> and <code>term</code> from
the above parse tree are non-terminal nodes created by the rules with the same
names.</p>
<p><code>NonTerminal</code> inherits from <code>list</code>. The elements of <code>NonTerminal</code> are its
children nodes.  So, you can use index access:</p>
<pre><code class="language-python">child = pt_node[2]
</code></pre>
<p>Or iteration:</p>
<pre><code class="language-python">for child in pt_node:
  ...
</code></pre>
<p>Additionally, you can access children by the child rule name:</p>
<p>For example:</p>
<pre><code class="language-python"># Grammar
def foo(): return &quot;a&quot;, bar, &quot;b&quot;, baz, &quot;c&quot;, ZeroOrMore(bar)
def bar(): return &quot;bar&quot;
def baz(): return &quot;baz&quot;

# Parsing
parser = ParserPython(foo)
result = parser.parse(&quot;a bar b baz c bar bar bar&quot;)

# Accessing parse tree nodes. All asserts will pass.
# Index access
assert result[1].rule_name  == 'bar'
# Access by rule name
assert result.bar.rule_name == 'bar'

# There are 8 children nodes of the root 'result' node.
# Each child is a terminal in this case.
assert len(result) == 8

# There is 4 bar matched from result (at the beginning and from ZeroOrMore)
# Dot access collect all NTs from the given path
assert len(result.bar) == 4
# You could call dot access recursively, e.g. result.bar.baz if the
# rule bar called baz. In that case all bars would be collected from
# the root and for each bar all baz will be collected.

# Verify position
# First 'bar' is at position 2 and second is at position 14
assert result.bar[0].position == 2
assert result.bar[1].position == 14

</code></pre>
<h2 id="printing-parse-trees">Printing parse trees<a class="headerlink" href="#printing-parse-trees" title="Permanent link">&para;</a></h2>
<p>Elements of the parse tree has <code>tree_str</code> method which can be used to print the
tree.</p>
<p>For example:</p>
<pre><code class="language-python">...
parse_tree = parser.parse(some_input)
print(parse_tree.tree_str())
</code></pre>
<p>Result might look something like:</p>
<pre><code>simpleLanguage=Sequence [0-191]
  keyword=Kwd(function) [0-8]: function
  symbol=RegExMatch(\w+) [9-12]: fak
  parameterlist=Sequence [13-20]
    symbol=RegExMatch(\w+) [13-14]: n
    symbol=RegExMatch(\w+) [16-17]: x
    symbol=RegExMatch(\w+) [19-20]: p
  block=Sequence [22-191]
    StrMatch({) [22-23]: {
    statement=Sequence [28-189]
      ifstatement=Sequence [28-188]
        keyword=Kwd(if) [28-30]: if
        StrMatch(() [31-32]: (
        expression=OrderedChoice [32-36]
          operation=Sequence [32-36]
            symbol=RegExMatch(\w+) [32-33]: n
            operator=RegExMatch(\+|\-|\*|\/|\=\=) [33-35]: ==
            literal=RegExMatch(\d*\.\d*|\d+|&quot;.*?&quot;) [35-36]: 0
        StrMatch()) [36-37]: )
        block=Sequence [38-93]
          StrMatch({) [38-39]: {
          statement=Sequence [78-87]
            returnstatement=Sequence [78-86]
              keyword=Kwd(return) [78-84]: return
              expression=OrderedChoice [85-86]
                literal=RegExMatch(\d*\.\d*|\d+|&quot;.*?&quot;) [85-86]: 0
            StrMatch(;) [86-87]: ;

</code></pre>
<p>Each line contains information about the rule and the span of the input where
the match occurred.</p>
<h2 id="parse-tree-reduction">Parse tree reduction<a class="headerlink" href="#parse-tree-reduction" title="Permanent link">&para;</a></h2>
<p>Parser can be configured to create a reduced parse tree. More information can be
found <a href="../configuration/#parse-tree-reduction">here</a>.</p>
<h2 id="suppressing-parse-tree-nodes">Suppressing parse tree nodes<a class="headerlink" href="#suppressing-parse-tree-nodes" title="Permanent link">&para;</a></h2>
<p>This feature is available for <code>ParserPython</code> only. Rule classes may have a class
level <code>suppress</code> attribute set to <code>True</code>. Parse tree nodes produced by these
rules will be removed from the resulting parse tree. This may be handy to reduce
syntax noise from the punctuation and such in the resulting parse tree.</p>
<pre><code class="language-python">class SuppressStrMatch(StrMatch):
    suppress = True

def grammar():
    return &quot;one&quot;, &quot;two&quot;, SuppressStrMatch(&quot;three&quot;), &quot;four&quot;

parser = ParserPython(grammar)

result = parser.parse(&quot;one two three four&quot;)
assert len(result) == 3
assert result[1] == &quot;two&quot;
assert result[2] == &quot;four&quot;
</code></pre>
<p>This feature can nicely be combined with <a href="../grammars/#overriding-of-special-rule-classes">overriding of special rule
classes</a>.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../grammars/" class="btn btn-neutral float-left" title="Grammars"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../handling_errors/" class="btn btn-neutral float-right" title="Handling errors">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright &copy; <a href="http://www.igordejanovic.net/">Igor DejanoviÄ‡</a>.</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/textX/Arpeggio" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../grammars/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../handling_errors/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../js/version-select.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
